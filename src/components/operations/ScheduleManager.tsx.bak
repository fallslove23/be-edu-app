import React, { useState, useEffect } from 'react';
import {
  CalendarDaysIcon,
  ClockIcon,
  MapPinIcon,
  UserIcon,
  PlusIcon,
  PencilIcon,
  TrashIcon,
  EyeIcon,
  XMarkIcon,
  CheckIcon,
  ExclamationTriangleIcon,
  ArrowLeftIcon,
  ArrowRightIcon,
  DocumentArrowUpIcon
} from '@heroicons/react/24/outline';
import ExcelScheduleImporter from '../courses/ExcelScheduleImporter';
import { useAuth } from '../../contexts/AuthContext';
import { FirebasePlannerService } from '../../services/firebase-planner.service';
import toast from 'react-hot-toast';

interface ScheduleEvent {
  id: string;
  title: string;
  courseCode: string;
  courseName: string;
  date: string;
  startTime: string;
  endTime: string;
  instructor: string;
  assistantInstructor?: string;
  coordinator: string;
  classroom: string;
  sessionNumber?: number;
  type: 'lecture' | 'exam' | 'practice' | 'orientation' | 'ceremony';
  status: 'scheduled' | 'in_progress' | 'completed' | 'cancelled';
  attendees: number;
  notes?: string;
  color?: string;
}

interface Classroom {
  id: string;
  name: string;
  capacity: number;
  equipment: string[];
  location: string;
  status: 'available' | 'occupied' | 'maintenance';
}

const ScheduleManager: React.FC = () => {
  const { user } = useAuth();
  const [events, setEvents] = useState<ScheduleEvent[]>([]);
  const [classrooms, setClassrooms] = useState<Classroom[]>([]);
  const [currentDate, setCurrentDate] = useState(new Date());
  const [selectedEvent, setSelectedEvent] = useState<ScheduleEvent | null>(null);
  const [viewMode, setViewMode] = useState<'week' | 'day' | 'month'>('week');
  const [showEventModal, setShowEventModal] = useState(false);
  const [editingEvent, setEditingEvent] = useState<ScheduleEvent | null>(null);
  const [loading, setLoading] = useState(true);
  const [showExcelImporter, setShowExcelImporter] = useState(false);
  const [isOffline, setIsOffline] = useState(false);
  const [lastSyncTime, setLastSyncTime] = useState<string>('');

  // ê´€ë¦¬ì ê¶Œí•œ ì²´í¬
  const isAdmin = user?.role === 'admin' || user?.role === 'instructor';
  const [formData, setFormData] = useState({
    title: '',
    courseCode: '',
    courseName: '',
    date: '',
    startTime: '',
    endTime: '',
    instructor: '',
    assistantInstructor: '',
    coordinator: '',
    classroom: '',
    sessionNumber: 1,
    type: 'lecture' as const,
    status: 'scheduled' as const,
    attendees: 0,
    notes: ''
  });

  // ê³¼ì • í…œí”Œë¦¿ì—ì„œ ìë™ìœ¼ë¡œ ì¼ì • ìƒì„±
  const [courses] = useState([
    {
      id: 'course-1',
      code: 'BS-2025-01',
      name: 'BS ì‹ ì… ì˜ì—…ì‚¬ì› ê¸°ì´ˆê³¼ì • 1ì°¨',
      duration: 5, // ì¼ìˆ˜
      startDate: '2025-01-26',
      instructor: 'ê¹€ê°•ì‚¬',
      coordinator: 'ë°•ìš´ì˜',
      sessions: [
        { title: 'ì˜¤ë¦¬ì—”í…Œì´ì…˜', type: 'orientation', duration: 8 },
        { title: 'ì˜ì—… ê¸°ì´ˆ ì´ë¡ ', type: 'lecture', duration: 3 },
        { title: 'ê³ ê° ì‘ëŒ€ ì‹¤ìŠµ', type: 'practice', duration: 4 },
        { title: 'ì œí’ˆ ì§€ì‹ í•™ìŠµ', type: 'lecture', duration: 3 },
        { title: 'ì´ë¡  ì‹œí—˜', type: 'exam', duration: 2 }
      ]
    },
    {
      id: 'course-2', 
      code: 'BS-2025-02',
      name: 'BS ê³ ê¸‰ ì˜ì—… ì „ëµê³¼ì • 2ì°¨',
      duration: 3,
      startDate: '2025-01-27',
      instructor: 'ì´ê°•ì‚¬',
      coordinator: 'ê¹€ìš´ì˜',
      sessions: [
        { title: 'ê³ ê¸‰ ì˜ì—… ì „ëµ', type: 'lecture', duration: 4 },
        { title: 'ì‹¤ìŠµ í‰ê°€', type: 'practice', duration: 3 },
        { title: 'ìµœì¢… í‰ê°€', type: 'exam', duration: 2 }
      ]
    }
  ]);

  useEffect(() => {
    loadData();
  }, []);

  // ê³¼ì • í…œí”Œë¦¿ì—ì„œ íƒ€ì„ë¼ì¸ ìë™ ìƒì„±
  const generateTimelineFromCourse = (course: any) => {
    const generatedEvents: ScheduleEvent[] = [];
    let currentDate = new Date(course.startDate);
    let sessionNumber = 1;

    course.sessions.forEach((session: any) => {
      const startHour = session.type === 'orientation' ? 9 : 
                       session.type === 'exam' ? 10 : 9;
      const endHour = startHour + Math.floor(session.duration);
      const endMinute = (session.duration % 1) * 60;

      const event: ScheduleEvent = {
        id: `${course.code}-session-${sessionNumber}`,
        title: `${sessionNumber}ì¼ì°¨ ${session.title}`,
        courseCode: course.code,
        courseName: course.name,
        date: currentDate.toISOString().split('T')[0],
        startTime: `${startHour.toString().padStart(2, '0')}:00`,
        endTime: `${endHour.toString().padStart(2, '0')}:${endMinute.toString().padStart(2, '0')}`,
        instructor: course.instructor,
        coordinator: course.coordinator,
        classroom: 'êµìœ¡ì‹¤ A', // ê¸°ë³¸ê°’
        sessionNumber: sessionNumber,
        type: session.type,
        status: 'scheduled',
        attendees: 25, // ê¸°ë³¸ê°’
        color: getColorByType(session.type)
      };

      generatedEvents.push(event);
      
      // ë‹¤ìŒ ë‚ ë¡œ ì´ë™ (ì£¼ë§ ì œì™¸)
      do {
        currentDate.setDate(currentDate.getDate() + 1);
      } while (currentDate.getDay() === 0 || currentDate.getDay() === 6); // ì¼ìš”ì¼(0), í† ìš”ì¼(6) ì œì™¸
      
      sessionNumber++;
    });

    return generatedEvents;
  };

  const loadData = async () => {
    setLoading(true);
    setIsOffline(false);

    try {
      // Firebase Plannerì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const startDate = new Date();
      startDate.setMonth(startDate.getMonth() - 1); // ì§€ë‚œ ë‹¬ë¶€í„°
      const endDate = new Date();
      endDate.setMonth(endDate.getMonth() + 2); // ë‹¤ìŒ ë‹¬ê¹Œì§€

      const calendarEvents = await FirebasePlannerService.getCalendarEvents(
        startDate.toISOString().split('T')[0],
        endDate.toISOString().split('T')[0]
      );

      // CalendarEvent â†’ ScheduleEvent ë³€í™˜
      const firebaseEvents: ScheduleEvent[] = calendarEvents.map(event => {
        const startDate = new Date(event.start);
        const endDate = new Date(event.end);

        return {
          id: event.id,
          title: event.title,
          courseCode: event.course_id || '',
          courseName: event.title,
          date: startDate.toISOString().split('T')[0],
          startTime: startDate.toTimeString().slice(0, 5),
          endTime: endDate.toTimeString().slice(0, 5),
          instructor: event.instructor_id || '',
          coordinator: '',
          classroom: event.classroom || '',
          type: 'lecture',
          status: event.status as 'scheduled' | 'in_progress' | 'completed' | 'cancelled',
          attendees: 0,
          color: event.color
        };
      });

      // ê³¼ì • í…œí”Œë¦¿ì—ì„œ ìë™ ìƒì„±ëœ ì¼ì •ë“¤ (ë¡œì»¬)
      const generatedEvents: ScheduleEvent[] = [];
      courses.forEach(course => {
        const courseEvents = generateTimelineFromCourse(course);
        generatedEvents.push(...courseEvents);
      });

      // Firebase ë°ì´í„° ìš°ì„ , ë¡œì»¬ í…œí”Œë¦¿ì€ ë³´ì¡°
      const allEvents = firebaseEvents.length > 0 ? firebaseEvents : generatedEvents;

      setEvents(allEvents);
      setLastSyncTime(new Date().toLocaleTimeString('ko-KR'));

    } catch (error) {
      console.error('Firebase ì—°ë™ ì¤‘ ì˜¤ë¥˜:', error);
      setIsOffline(true);
      toast.error('Firebase ì—°ë™ ì‹¤íŒ¨ - ë¡œì»¬ ë°ì´í„°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.');

      // Fallback: ê³¼ì • í…œí”Œë¦¿ì—ì„œ ìƒì„±
      const generatedEvents: ScheduleEvent[] = [];
      courses.forEach(course => {
        const courseEvents = generateTimelineFromCourse(course);
        generatedEvents.push(...courseEvents);
      });

      setEvents(generatedEvents);
    } finally {
      // ê°•ì˜ì‹¤ ë°ì´í„°ëŠ” ë¡œì»¬
      const mockClassrooms: Classroom[] = [
        {
          id: 'room-a',
          name: 'êµìœ¡ì‹¤ A',
          capacity: 30,
          equipment: ['í”„ë¡œì í„°', 'í™”ì´íŠ¸ë³´ë“œ', 'ìŒí–¥ì‹œì„¤', 'ì—ì–´ì»¨'],
          location: 'ë³¸ê´€ 2ì¸µ',
          status: 'available'
        },
        {
          id: 'room-b',
          name: 'êµìœ¡ì‹¤ B',
          capacity: 20,
          equipment: ['í”„ë¡œì í„°', 'ì»´í“¨í„°', 'í™”ì´íŠ¸ë³´ë“œ'],
          location: 'ë³¸ê´€ 3ì¸µ',
          status: 'available'
        },
        {
          id: 'room-c',
          name: 'ì‹¤ìŠµì‹¤',
          capacity: 25,
          equipment: ['ì»´í“¨í„°', 'ì‹¤ìŠµì¥ë¹„', 'í”„ë¡œì í„°'],
          location: 'ë³„ê´€ 1ì¸µ',
          status: 'maintenance'
        }
      ];

      setClassrooms(mockClassrooms);
      setLoading(false);
    }
  };

  const getWeekDays = (date: Date) => {
    const week = [];
    const startOfWeek = new Date(date);
    const day = startOfWeek.getDay();
    const diff = startOfWeek.getDate() - day + (day === 0 ? -6 : 1); // ì›”ìš”ì¼ ì‹œì‘
    startOfWeek.setDate(diff);

    for (let i = 0; i < 7; i++) {
      const day = new Date(startOfWeek);
      day.setDate(startOfWeek.getDate() + i);
      week.push(day);
    }
    return week;
  };

  const getEventsForDate = (date: Date) => {
    const dateString = date.toISOString().split('T')[0];
    return events.filter(event => event.date === dateString);
  };

  const getMonthDays = (date: Date) => {
    const year = date.getFullYear();
    const month = date.getMonth();
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const startDate = new Date(firstDay);
    const endDate = new Date(lastDay);
    
    // ì›”ìš”ì¼ ì‹œì‘ìœ¼ë¡œ ì¡°ì •
    const startDayOfWeek = firstDay.getDay();
    const daysToSubtract = startDayOfWeek === 0 ? 6 : startDayOfWeek - 1;
    startDate.setDate(firstDay.getDate() - daysToSubtract);
    
    // ì¼ìš”ì¼ ì¢…ë£Œë¡œ ì¡°ì •
    const endDayOfWeek = lastDay.getDay();
    const daysToAdd = endDayOfWeek === 0 ? 0 : 7 - endDayOfWeek;
    endDate.setDate(lastDay.getDate() + daysToAdd);
    
    const days = [];
    const currentDate = new Date(startDate);
    
    while (currentDate <= endDate) {
      days.push(new Date(currentDate));
      currentDate.setDate(currentDate.getDate() + 1);
    }
    
    return days;
  };

  const getStatusBadgeClass = (status: string) => {
    switch (status) {
      case 'scheduled': return 'bg-secondary text-secondary-foreground border border-border';
      case 'in_progress': return 'bg-primary text-primary-foreground border border-primary';
      case 'completed': return 'bg-muted text-muted-foreground border border-border';
      case 'cancelled': return 'bg-destructive/10 text-destructive border border-destructive/20';
      default: return 'bg-muted text-muted-foreground border border-border';
    }
  };

  const getTypeBadgeClass = (type: string) => {
    switch (type) {
      case 'lecture': return 'bg-accent/20 text-accent-foreground border border-accent/30';
      case 'exam': return 'bg-destructive/10 text-destructive border border-destructive/20';
      case 'practice': return 'bg-secondary text-secondary-foreground border border-border';
      case 'orientation': return 'bg-primary/10 text-primary border border-primary/20';
      case 'ceremony': return 'bg-accent text-accent-foreground border border-accent';
      default: return 'bg-muted text-muted-foreground border border-border';
    }
  };

  const getTypeLabel = (type: string) => {
    switch (type) {
      case 'lecture': return 'ê°•ì˜';
      case 'exam': return 'ì‹œí—˜';
      case 'practice': return 'ì‹¤ìŠµ';
      case 'orientation': return 'ì˜¤ë¦¬ì—”í…Œì´ì…˜';
      case 'ceremony': return 'í–‰ì‚¬';
      default: return 'ê¸°íƒ€';
    }
  };

  const navigateWeek = (direction: 'prev' | 'next') => {
    const newDate = new Date(currentDate);
    newDate.setDate(currentDate.getDate() + (direction === 'next' ? 7 : -7));
    setCurrentDate(newDate);
  };

  const navigateDay = (direction: 'prev' | 'next') => {
    const newDate = new Date(currentDate);
    newDate.setDate(currentDate.getDate() + (direction === 'next' ? 1 : -1));
    setCurrentDate(newDate);
  };

  const navigateMonth = (direction: 'prev' | 'next') => {
    const newDate = new Date(currentDate);
    newDate.setMonth(currentDate.getMonth() + (direction === 'next' ? 1 : -1));
    setCurrentDate(newDate);
  };

  // ì—‘ì…€ ì¼ì • ê°€ì ¸ì˜¤ê¸° í•¸ë“¤ëŸ¬
  const handleExcelImport = async (scheduleData: any[]) => {
    try {
      // ì—‘ì…€ ë°ì´í„°ë¥¼ ScheduleEvent í˜•ì‹ìœ¼ë¡œ ë³€í™˜
      const newEvents: ScheduleEvent[] = scheduleData.map((row, index) => ({
        id: `excel-${Date.now()}-${index}`,
        title: row.êµìœ¡ì£¼ì œ,
        courseCode: 'EXCEL-IMPORT',
        courseName: 'ì—‘ì…€ ê°€ì ¸ì˜¤ê¸° ì¼ì •',
        date: row.ë‚ ì§œ,
        startTime: row.ì‹œì‘ì‹œê°„,
        endTime: row.ì¢…ë£Œì‹œê°„,
        instructor: row.ê°•ì‚¬ëª…,
        assistantInstructor: row.ë³´ì¡°ê°•ì‚¬ || undefined,
        coordinator: row.ìš´ì˜ë‹´ë‹¹ì,
        classroom: row.ê°•ì˜ì‹¤ || 'ë¯¸ì •',
        sessionNumber: row.ì¼ì°¨,
        type: 'lecture' as const,
        status: 'scheduled' as const,
        attendees: 0,
        notes: row.ë¹„ê³  || '',
        color: '#10B981'
      }));

      // ê¸°ì¡´ ì¼ì •ì— ì¶”ê°€
      setEvents(prev => [...prev, ...newEvents]);
      
      console.log(`${newEvents.length}ê°œì˜ ì¼ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
    } catch (error) {
      console.error('ì¼ì • ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
      throw error;
    }
  };


  // ì¼ì • ì €ì¥ í•¸ë“¤ëŸ¬
  const handleSaveEvent = () => {
    if (!formData.title || !formData.date || !formData.startTime || !formData.endTime || !formData.instructor || !formData.coordinator) {
      alert('í•„ìˆ˜ í•„ë“œë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }

    const newEvent: ScheduleEvent = {
      ...formData,
      id: editingEvent ? editingEvent.id : `event-${Date.now()}`,
      color: getColorByType(formData.type)
    };

    if (editingEvent) {
      // í¸ì§‘ ëª¨ë“œ
      setEvents(prev => prev.map(event => event.id === editingEvent.id ? newEvent : event));
    } else {
      // ìƒˆ ì¼ì • ì¶”ê°€
      setEvents(prev => [...prev, newEvent]);
    }

    // í¼ ì´ˆê¸°í™” ë° ëª¨ë‹¬ ë‹«ê¸°
    resetForm();
    setShowEventModal(false);
    setEditingEvent(null);
  };

  // í¼ ì´ˆê¸°í™”
  const resetForm = () => {
    setFormData({
      title: '',
      courseCode: '',
      courseName: '',
      date: '',
      startTime: '',
      endTime: '',
      instructor: '',
      assistantInstructor: '',
      coordinator: '',
      classroom: '',
      sessionNumber: 1,
      type: 'lecture',
      status: 'scheduled',
      attendees: 0,
      notes: ''
    });
  };

  // íƒ€ì…ë³„ ìƒ‰ìƒ ê°€ì ¸ì˜¤ê¸°
  const getColorByType = (type: string) => {
    switch (type) {
      case 'lecture': return '#10B981';
      case 'exam': return '#EF4444';
      case 'practice': return '#F59E0B';
      case 'orientation': return '#3B82F6';
      case 'ceremony': return '#8B5CF6';
      default: return '#6B7280';
    }
  };

  // êµ¬ê¸€ ìº˜ë¦°ë” ì—°ë™
  const exportToGoogleCalendar = () => {
    // í˜„ì¬ ë³´ê³  ìˆëŠ” ê¸°ê°„ì˜ ì´ë²¤íŠ¸ë§Œ ì„ íƒ (ì˜ˆ: í˜„ì¬ ì›”)
    const currentMonth = currentDate.getMonth();
    const currentYear = currentDate.getFullYear();
    const monthEvents = events.filter(event => {
      const eventDate = new Date(event.date);
      return eventDate.getMonth() === currentMonth && eventDate.getFullYear() === currentYear;
    });

    if (monthEvents.length === 0) {
      alert('í˜„ì¬ ê¸°ê°„ì— ë‚´ë³´ë‚¼ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.');
      return;
    }

    // Google Calendar URL ìƒì„±
    monthEvents.forEach(event => {
      const eventDateTime = new Date(`${event.date}T${event.startTime}`);
      const endDateTime = new Date(`${event.date}T${event.endTime}`);
      
      // UTC ì‹œê°„ìœ¼ë¡œ ë³€í™˜
      const startTime = eventDateTime.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
      const endTime = endDateTime.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
      
      const details = [
        `ê°•ì‚¬: ${event.instructor}`,
        event.assistantInstructor ? `ë³´ì¡°ê°•ì‚¬: ${event.assistantInstructor}` : '',
        `ìš´ì˜ë‹´ë‹¹ì: ${event.coordinator}`,
        `ê°•ì˜ì‹¤: ${event.classroom}`,
        `ì°¸ì„ì¸ì›: ${event.attendees}ëª…`,
        event.notes ? `ë©”ëª¨: ${event.notes}` : ''
      ].filter(Boolean).join('\\n');

      const googleCalendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(event.title)}&dates=${startTime}/${endTime}&details=${encodeURIComponent(details)}&location=${encodeURIComponent(event.classroom)}&ctz=Asia/Seoul`;
      
      // ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
      window.open(googleCalendarUrl, '_blank');
    });

    alert(`${monthEvents.length}ê°œì˜ ì¼ì •ì„ êµ¬ê¸€ ìº˜ë¦°ë”ì— ì¶”ê°€í•˜ê¸° ìœ„í•´ ìƒˆ íƒ­ì´ ì—´ë ¸ìŠµë‹ˆë‹¤.`);
  };

  // ìƒˆë¡œìš´ ê³¼ì • ì¶”ê°€ ì‹œ ìë™ íƒ€ì„ë¼ì¸ ìƒì„±
  const addCourseToTimeline = (newCourse: any) => {
    const newEvents = generateTimelineFromCourse(newCourse);
    setEvents(prev => [...prev, ...newEvents]);
    
    alert(`${newCourse.name} ê³¼ì •ì˜ ${newEvents.length}ê°œ ì¼ì •ì´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`);
  };

  // í¸ì§‘ ëª¨ë“œë¡œ ì „í™˜
  const handleEditEvent = (event: ScheduleEvent) => {
    setFormData({
      title: event.title,
      courseCode: event.courseCode,
      courseName: event.courseName,
      date: event.date,
      startTime: event.startTime,
      endTime: event.endTime,
      instructor: event.instructor,
      assistantInstructor: event.assistantInstructor || '',
      coordinator: event.coordinator,
      classroom: event.classroom,
      sessionNumber: event.sessionNumber || 1,
      type: event.type,
      status: event.status,
      attendees: event.attendees,
      notes: event.notes || ''
    });
    setEditingEvent(event);
    setShowEventModal(true);
  };

  const EventModal: React.FC<{ event: ScheduleEvent; onClose: () => void }> = ({ event, onClose }) => (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-card rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
        <div className="px-6 py-4 border-b border-border flex justify-between items-center">
          <h3 className="text-lg font-medium text-card-foreground">ì¼ì • ìƒì„¸</h3>
          <button
            onClick={onClose}
            className="text-muted-foreground hover:text-foreground transition-colors"
          >
            <XMarkIcon className="h-6 w-6" />
          </button>
        </div>

        <div className="p-6 space-y-4">
          <div>
            <h4 className="text-xl font-bold text-card-foreground">{event.title}</h4>
            <p className="text-muted-foreground">{event.courseName}</p>
          </div>

          <div className="space-y-3">
            <div className="flex items-center space-x-3">
              <CalendarDaysIcon className="h-5 w-5 text-muted-foreground" />
              <span className="text-card-foreground">{event.date}</span>
            </div>

            <div className="flex items-center space-x-3">
              <ClockIcon className="h-5 w-5 text-muted-foreground" />
              <span className="text-card-foreground">{event.startTime} - {event.endTime}</span>
            </div>

            <div className="flex items-center space-x-3">
              <MapPinIcon className="h-5 w-5 text-muted-foreground" />
              <span className="text-card-foreground">{event.classroom}</span>
            </div>

            <div className="flex items-center space-x-3">
              <UserIcon className="h-5 w-5 text-muted-foreground" />
              <div className="text-card-foreground">
                <div>ì£¼ê°•ì‚¬: {event.instructor}</div>
                {event.assistantInstructor && (
                  <div className="text-sm text-muted-foreground">ë³´ì¡°ê°•ì‚¬: {event.assistantInstructor}</div>
                )}
                <div className="text-sm text-muted-foreground">ìš´ì˜ë‹´ë‹¹ì: {event.coordinator}</div>
              </div>
            </div>
          </div>

          <div className="flex items-center space-x-4">
            <span className={`inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium ${getTypeBadgeClass(event.type)}`}>
              {getTypeLabel(event.type)}
            </span>
            <span className={`inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium ${getStatusBadgeClass(event.status)}`}>
              {event.status === 'scheduled' ? 'ì˜ˆì •' :
               event.status === 'in_progress' ? 'ì§„í–‰ì¤‘' :
               event.status === 'completed' ? 'ì™„ë£Œ' : 'ì·¨ì†Œ'}
            </span>
          </div>

          <div>
            <span className="text-sm text-muted-foreground">ì°¸ì„ ì¸ì›: </span>
            <span className="text-sm font-medium text-card-foreground">{event.attendees}ëª…</span>
          </div>

          {event.notes && (
            <div>
              <h5 className="text-sm font-medium text-card-foreground mb-2">ë©”ëª¨</h5>
              <p className="text-sm text-muted-foreground bg-secondary/30 p-3 rounded-lg border border-border">
                {event.notes}
              </p>
            </div>
          )}
        </div>

        {isAdmin && (
          <div className="px-6 py-4 border-t border-border flex justify-end space-x-3">
            <button
              onClick={() => {
                handleEditEvent(event);
                onClose();
              }}
              className="btn-primary flex items-center space-x-2"
            >
              <PencilIcon className="h-4 w-4" />
              <span>í¸ì§‘</span>
            </button>
          </div>
        )}
      </div>
    </div>
  );

  if (loading) {
    return (
      <div className="flex items-center justify-center h-64">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
        <span className="ml-2">ì¼ì • ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* í—¤ë” */}
      <div className="bg-card rounded-xl shadow-sm border border-border p-6">
        <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center space-y-4 sm:space-y-0">
          <div>
            <h1 className="text-2xl font-bold text-card-foreground mb-2">ğŸ“… ì¼ì • ê´€ë¦¬</h1>
            <p className="text-muted-foreground">
              {isAdmin
                ? 'ê°•ì˜ ì¼ì • ë° êµì‹¤ ë°°ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤. ëª¨ë“  êµìœ¡ìƒì´ ì „ì²´ ì¼ì •ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.'
                : 'ì „ì²´ êµìœ¡ ì¼ì •ì„ í™•ì¸í•˜ê³  ë‚˜ì˜ ìˆ˜ì—… ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.'}
            </p>
          </div>
          <div className="flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-3">
            <div className="flex items-center bg-secondary/50 rounded-lg p-1 border border-border">
              {(['day', 'week', 'month'] as const).map((mode) => (
                <button
                  key={mode}
                  onClick={() => setViewMode(mode)}
                  className={`px-3 py-1.5 rounded-md text-sm font-medium transition-colors ${
                    viewMode === mode
                      ? 'bg-card text-card-foreground shadow-sm border border-border'
                      : 'text-muted-foreground hover:text-foreground hover:bg-accent/30'
                  }`}
                >
                  {mode === 'day' ? 'ì¼' : mode === 'week' ? 'ì£¼' : 'ì›”'}
                </button>
              ))}
            </div>

            {isAdmin && (
              <div className="flex items-center space-x-2">
                <button
                  onClick={() => setShowExcelImporter(true)}
                  className="btn-secondary flex items-center space-x-2 text-sm"
                >
                  <DocumentArrowUpIcon className="h-4 w-4" />
                  <span>ì—‘ì…€ ê°€ì ¸ì˜¤ê¸°</span>
                </button>

                <button
                  onClick={() => {
                    // ìƒˆ ê³¼ì • ì‹œì—°ìš© ë°ì´í„°
                    const demoCourse = {
                      id: 'demo-course',
                      code: 'BS-2025-03',
                      name: 'BS ì‹ ì… ê´€ë¦¬ì ë¦¬ë”ì‹­ê³¼ì •',
                      duration: 3,
                      startDate: '2025-02-10',
                      instructor: 'ìµœê°•ì‚¬',
                      coordinator: 'ì´ìš´ì˜',
                      sessions: [
                        { title: 'ë¦¬ë”ì‹­ ê¸°ì´ˆ', type: 'lecture', duration: 4 },
                        { title: 'íŒ€ ê´€ë¦¬ ì‹¤ìŠµ', type: 'practice', duration: 3 },
                        { title: 'ì¢…í•© í‰ê°€', type: 'exam', duration: 2 }
                      ]
                    };
                    addCourseToTimeline(demoCourse);
                  }}
                  className="btn-outline flex items-center space-x-2 text-sm"
                >
                  <PlusIcon className="h-4 w-4" />
                  <span>ê³¼ì • ì—°ë™</span>
                </button>

                <button
                  onClick={exportToGoogleCalendar}
                  className="btn-outline flex items-center space-x-2 text-sm"
                >
                  <svg className="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/>
                  </svg>
                  <span>êµ¬ê¸€ ìº˜ë¦°ë”</span>
                </button>

                <button
                  onClick={() => setShowEventModal(true)}
                  className="btn-primary flex items-center space-x-2 font-medium"
                >
                  <PlusIcon className="h-4 w-4" />
                  <span>ì¼ì • ì¶”ê°€</span>
                </button>
              </div>
            )}
          </div>
        </div>
      </div>

      {/* ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="bg-card rounded-xl shadow-sm border border-border p-4">
        <div className="flex items-center justify-between">
          <button
            onClick={() => {
              if (viewMode === 'week') navigateWeek('prev');
              else if (viewMode === 'month') navigateMonth('prev');
              else navigateDay('prev');
            }}
            className="p-2 rounded-lg text-muted-foreground hover:bg-accent/30 hover:text-foreground transition-colors"
          >
            <ArrowLeftIcon className="h-5 w-5" />
          </button>

          <div className="text-center">
            <h2 className="text-lg font-semibold text-card-foreground">
              {viewMode === 'week' ? (
                `${getWeekDays(currentDate)[0].toLocaleDateString('ko-KR', { month: 'long', day: 'numeric' })} - ${getWeekDays(currentDate)[6].toLocaleDateString('ko-KR', { month: 'long', day: 'numeric' })}`
              ) : viewMode === 'month' ? (
                currentDate.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long' })
              ) : (
                currentDate.toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' })
              )}
            </h2>
            <p className="text-sm text-muted-foreground">
              {currentDate.getFullYear()}ë…„
            </p>
          </div>

          <button
            onClick={() => {
              if (viewMode === 'week') navigateWeek('next');
              else if (viewMode === 'month') navigateMonth('next');
              else navigateDay('next');
            }}
            className="p-2 rounded-lg text-muted-foreground hover:bg-accent/30 hover:text-foreground transition-colors"
          >
            <ArrowRightIcon className="h-5 w-5" />
          </button>
        </div>
      </div>

      {/* ìº˜ë¦°ë” ë·° */}
      {viewMode === 'week' ? (
        <div className="bg-card rounded-xl shadow-sm border border-border overflow-hidden">
          <div className="grid grid-cols-7 border-b border-border">
            {['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'].map((day, index) => (
              <div key={day} className="p-4 text-center border-r border-border last:border-r-0">
                <div className="text-sm font-medium text-card-foreground">{day}</div>
                <div className="text-xs text-muted-foreground mt-1">
                  {getWeekDays(currentDate)[index].getDate()}
                </div>
              </div>
            ))}
          </div>

          <div className="grid grid-cols-7 divide-x divide-border" style={{ minHeight: '500px' }}>
            {getWeekDays(currentDate).map((day, dayIndex) => (
              <div key={dayIndex} className="p-2 space-y-1">
                {getEventsForDate(day).map((event) => (
                  <div
                    key={event.id}
                    onClick={() => setSelectedEvent(event)}
                    className="p-2 rounded text-xs cursor-pointer hover:opacity-80 transition-opacity bg-accent/10 border-l-2 border-accent"
                  >
                    <div className="font-medium text-card-foreground truncate">
                      {event.title}
                    </div>
                    <div className="text-muted-foreground truncate">
                      {event.startTime}-{event.endTime}
                    </div>
                    <div className="text-muted-foreground truncate">
                      {event.classroom}
                    </div>
                  </div>
                ))}
              </div>
            ))}
          </div>
        </div>
      ) : viewMode === 'month' ? (
        <div className="bg-card rounded-xl shadow-sm border border-border overflow-hidden">
          <div className="grid grid-cols-7 border-b border-border">
            {['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'].map((day) => (
              <div key={day} className="p-3 text-center border-r border-border last:border-r-0">
                <div className="text-sm font-medium text-card-foreground">{day}</div>
              </div>
            ))}
          </div>

          <div className="grid grid-cols-7">
            {getMonthDays(currentDate).map((day, dayIndex) => {
              const dayEvents = getEventsForDate(day);
              const isCurrentMonth = day.getMonth() === currentDate.getMonth();
              const isToday = day.toDateString() === new Date().toDateString();

              return (
                <div
                  key={dayIndex}
                  className={`min-h-[120px] p-2 border-r border-b border-border last:border-r-0 ${
                    !isCurrentMonth ? 'bg-muted/30' : ''
                  } ${isToday ? 'bg-primary/5 border-primary/20' : ''}`}
                >
                  <div className={`text-sm font-medium mb-1 ${
                    !isCurrentMonth ? 'text-muted-foreground' :
                    isToday ? 'text-primary font-bold' :
                    'text-card-foreground'
                  }`}>
                    {day.getDate()}
                  </div>

                  <div className="space-y-1">
                    {dayEvents.slice(0, 3).map((event) => (
                      <div
                        key={event.id}
                        onClick={() => setSelectedEvent(event)}
                        className="text-xs p-1 rounded cursor-pointer hover:opacity-80 transition-opacity bg-accent/10 border-l-2 border-accent"
                      >
                        <div className="font-medium text-card-foreground truncate">
                          {event.title}
                        </div>
                        <div className="text-muted-foreground truncate">
                          {event.startTime}
                        </div>
                      </div>
                    ))}
                    {dayEvents.length > 3 && (
                      <div className="text-xs text-muted-foreground p-1">
                        +{dayEvents.length - 3}ê°œ ë”
                      </div>
                    )}
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      ) : (
        <div className="bg-card rounded-xl shadow-sm border border-border">
          <div className="px-6 py-4 border-b border-border">
            <h3 className="text-lg font-medium text-card-foreground">
              {currentDate.toLocaleDateString('ko-KR', { month: 'long', day: 'numeric', weekday: 'long' })} ì¼ì •
            </h3>
          </div>

          <div className="p-6">
            {getEventsForDate(currentDate).length > 0 ? (
              <div className="space-y-4">
                {getEventsForDate(currentDate).map((event) => (
                  <div
                    key={event.id}
                    onClick={() => setSelectedEvent(event)}
                    className="border border-border rounded-lg p-4 cursor-pointer hover:bg-accent/5 transition-colors"
                  >
                    <div className="flex items-center justify-between mb-2">
                      <h4 className="font-medium text-card-foreground">{event.title}</h4>
                      <div className="flex items-center space-x-2">
                        <span className={`inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium ${getTypeBadgeClass(event.type)}`}>
                          {getTypeLabel(event.type)}
                        </span>
                        <span className={`inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium ${getStatusBadgeClass(event.status)}`}>
                          {event.status === 'scheduled' ? 'ì˜ˆì •' :
                           event.status === 'in_progress' ? 'ì§„í–‰ì¤‘' :
                           event.status === 'completed' ? 'ì™„ë£Œ' : 'ì·¨ì†Œ'}
                        </span>
                      </div>
                    </div>

                    <div className="grid grid-cols-2 gap-4 text-sm text-muted-foreground">
                      <div className="flex items-center space-x-2">
                        <ClockIcon className="h-4 w-4" />
                        <span>{event.startTime} - {event.endTime}</span>
                      </div>
                      <div className="flex items-center space-x-2">
                        <MapPinIcon className="h-4 w-4" />
                        <span>{event.classroom}</span>
                      </div>
                      <div className="flex items-center space-x-2">
                        <UserIcon className="h-4 w-4" />
                        <span>{event.instructor}</span>
                      </div>
                      <div>
                        <span>ì°¸ì„: {event.attendees}ëª…</span>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            ) : (
              <div className="text-center py-8 text-muted-foreground">
                ì„ íƒí•œ ë‚ ì§œì— ì˜ˆì •ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤.
              </div>
            )}
          </div>
        </div>
      )}

      {/* ì¼ì • ë¶„ì„ - ê´€ë¦¬ìë§Œ í‘œì‹œ */}
      {isAdmin && (
        <div className="bg-card rounded-xl shadow-sm border border-border">
          <div className="px-6 py-4 border-b border-border">
            <h3 className="text-lg font-medium text-card-foreground">ğŸ“Š ì¼ì • ë¶„ì„</h3>
          </div>

          <div className="p-6">
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
            {/* ì¼ì • í†µê³„ */}
            <div className="bg-secondary/30 rounded-lg p-4 border border-border">
              <h4 className="font-medium text-muted-foreground mb-2">ğŸ“… ì „ì²´ ì¼ì •</h4>
              <p className="text-2xl font-bold text-card-foreground">{events.length}ê°œ</p>
              <p className="text-sm text-muted-foreground">ë“±ë¡ëœ ì¼ì •</p>
            </div>

            {/* ê°•ì‚¬ í˜„í™© */}
            <div className="bg-accent/10 rounded-lg p-4 border border-border">
              <h4 className="font-medium text-muted-foreground mb-2">ğŸ‘¨â€ğŸ« í™œë™ ê°•ì‚¬</h4>
              <p className="text-2xl font-bold text-card-foreground">
                {new Set(events.map(e => e.instructor)).size}ëª…
              </p>
              <p className="text-sm text-muted-foreground">ì°¸ì—¬ ê°•ì‚¬ ìˆ˜</p>
            </div>

            {/* ì¤‘ë³µ ì¼ì • í™•ì¸ */}
            <div className="bg-muted/30 rounded-lg p-4 border border-border">
              <h4 className="font-medium text-muted-foreground mb-2">âš ï¸ ì¤‘ë³µ ì¼ì •</h4>
              <p className="text-2xl font-bold text-card-foreground">
                {events.filter((event, index) =>
                  events.some((other, otherIndex) =>
                    index !== otherIndex &&
                    event.date === other.date &&
                    event.instructor === other.instructor &&
                    !(event.endTime <= other.startTime || other.endTime <= event.startTime)
                  )
                ).length}ê°œ
              </p>
              <p className="text-sm text-muted-foreground">ì‹œê°„ ì¤‘ë³µ ì¼ì •</p>
            </div>
          </div>

          {/* ì§„í–‰ì¤‘ì¸ ê³¼ì • ìš”ì•½ */}
          <div className="mt-6">
            <h4 className="font-medium text-card-foreground mb-3">ğŸ“š ì§„í–‰ì¤‘ì¸ ê³¼ì • í˜„í™©</h4>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {Array.from(new Map(events.map(event => [event.courseCode, event])).values()).map((course) => {
                const courseEvents = events.filter(e => e.courseCode === course.courseCode);
                const completedEvents = courseEvents.filter(e => e.status === 'completed');
                const upcomingEvents = courseEvents.filter(e => e.status === 'scheduled');
                const progressPercent = Math.round((completedEvents.length / courseEvents.length) * 100);

                return (
                  <div key={course.courseCode} className="border border-border rounded-lg p-4">
                    <div className="flex items-center justify-between mb-3">
                      <div>
                        <h5 className="font-medium text-card-foreground">{course.courseName}</h5>
                        <p className="text-sm text-muted-foreground">{course.courseCode}</p>
                      </div>
                      <span className={`px-2.5 py-1 rounded-md text-xs font-medium border ${
                        progressPercent === 100 ? 'bg-muted text-muted-foreground border-border' :
                        progressPercent > 0 ? 'bg-secondary text-secondary-foreground border-border' :
                        'bg-secondary/50 text-muted-foreground border-border'
                      }`}>
                        {progressPercent}% ì™„ë£Œ
                      </span>
                    </div>

                    <div className="space-y-2 text-sm">
                      <div className="flex justify-between text-muted-foreground">
                        <span>ì „ì²´ ì¼ì •:</span>
                        <span className="text-card-foreground font-medium">{courseEvents.length}íšŒ</span>
                      </div>
                      <div className="flex justify-between text-muted-foreground">
                        <span>ì™„ë£Œ:</span>
                        <span className="text-card-foreground font-medium">{completedEvents.length}íšŒ</span>
                      </div>
                      <div className="flex justify-between text-muted-foreground">
                        <span>ì˜ˆì •:</span>
                        <span className="text-card-foreground font-medium">{upcomingEvents.length}íšŒ</span>
                      </div>
                      <div className="flex justify-between text-muted-foreground">
                        <span>ì°¸ì—¬ ì¸ì›:</span>
                        <span className="text-card-foreground font-medium">{course.attendees}ëª…</span>
                      </div>
                    </div>

                    {/* ì§„í–‰ ë°” */}
                    <div className="mt-3">
                      <div className="w-full bg-muted/30 rounded-full h-2 border border-border">
                        <div
                          className={`h-2 rounded-full transition-all duration-300 ${
                            progressPercent === 100 ? 'bg-muted' : 'bg-primary'
                          }`}
                          style={{ width: `${progressPercent}%` }}
                        ></div>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      )}

      {/* ì´ë²¤íŠ¸ ìƒì„¸ ëª¨ë‹¬ */}
      {selectedEvent && (
        <EventModal 
          event={selectedEvent} 
          onClose={() => setSelectedEvent(null)} 
        />
      )}

      {/* ì¼ì • ì¶”ê°€/í¸ì§‘ ëª¨ë‹¬ */}
      {showEventModal && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
          <div className="bg-card rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
            <div className="px-6 py-4 border-b border-border">
              <h3 className="text-lg font-medium text-card-foreground">
                {editingEvent ? 'ì¼ì • í¸ì§‘' : 'ì¼ì • ì¶”ê°€'}
              </h3>
            </div>

            <div className="p-6">
              <form className="space-y-6">
                {/* ê¸°ë³¸ ì •ë³´ */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ì¼ì • ì œëª© *
                    </label>
                    <input
                      type="text"
                      value={formData.title}
                      onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                      placeholder="ì˜ˆ: 1ì¼ì°¨ ì˜¤ë¦¬ì—”í…Œì´ì…˜"
                    />
                  </div>

                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ê³¼ì • ì½”ë“œ
                    </label>
                    <input
                      type="text"
                      value={formData.courseCode}
                      onChange={(e) => setFormData({ ...formData, courseCode: e.target.value })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                      placeholder="ì˜ˆ: BS-2025-01"
                    />
                  </div>
                </div>

                <div>
                  <label className="block text-sm font-medium text-card-foreground mb-2">
                    ê³¼ì •ëª…
                  </label>
                  <input
                    type="text"
                    value={formData.courseName}
                    onChange={(e) => setFormData({ ...formData, courseName: e.target.value })}
                    className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                    placeholder="ì˜ˆ: BS ì‹ ì… ì˜ì—…ì‚¬ì› ê¸°ì´ˆê³¼ì • 1ì°¨"
                  />
                </div>

                {/* ì¼ì • ì •ë³´ */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ë‚ ì§œ *
                    </label>
                    <input
                      type="date"
                      value={formData.date}
                      onChange={(e) => setFormData({ ...formData, date: e.target.value })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ì‹œì‘ ì‹œê°„ *
                    </label>
                    <input
                      type="time"
                      value={formData.startTime}
                      onChange={(e) => setFormData({ ...formData, startTime: e.target.value })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ì¢…ë£Œ ì‹œê°„ *
                    </label>
                    <input
                      type="time"
                      value={formData.endTime}
                      onChange={(e) => setFormData({ ...formData, endTime: e.target.value })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                    />
                  </div>
                </div>

                {/* ê°•ì‚¬ ë° ë‹´ë‹¹ì */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ì£¼ê°•ì‚¬ *
                    </label>
                    <input
                      type="text"
                      value={formData.instructor}
                      onChange={(e) => setFormData({ ...formData, instructor: e.target.value })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                      placeholder="ì˜ˆ: ê¹€ê°•ì‚¬"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ë³´ì¡°ê°•ì‚¬
                    </label>
                    <input
                      type="text"
                      value={formData.assistantInstructor}
                      onChange={(e) => setFormData({ ...formData, assistantInstructor: e.target.value })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                      placeholder="ì˜ˆ: ì´ë³´ì¡°"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ìš´ì˜ë‹´ë‹¹ì *
                    </label>
                    <input
                      type="text"
                      value={formData.coordinator}
                      onChange={(e) => setFormData({ ...formData, coordinator: e.target.value })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                      placeholder="ì˜ˆ: ë°•ìš´ì˜"
                    />
                  </div>
                </div>

                {/* ê°•ì˜ì‹¤ ë° ì„¸ì…˜ ì •ë³´ */}
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ê°•ì˜ì‹¤
                    </label>
                    <select
                      value={formData.classroom}
                      onChange={(e) => setFormData({ ...formData, classroom: e.target.value })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                    >
                      <option value="">ê°•ì˜ì‹¤ ì„ íƒ</option>
                      {classrooms.map((room) => (
                        <option key={room.id} value={room.name} disabled={room.status !== 'available'}>
                          {room.name} ({room.capacity}ëª…) {room.status !== 'available' && '- ì‚¬ìš©ë¶ˆê°€'}
                        </option>
                      ))}
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ì„¸ì…˜ ë²ˆí˜¸
                    </label>
                    <input
                      type="number"
                      min="1"
                      value={formData.sessionNumber}
                      onChange={(e) => setFormData({ ...formData, sessionNumber: parseInt(e.target.value) || 1 })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                    />
                  </div>
                </div>

                {/* ìœ í˜• ë° ìƒíƒœ */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ì¼ì • ìœ í˜•
                    </label>
                    <select
                      value={formData.type}
                      onChange={(e) => setFormData({ ...formData, type: e.target.value as any })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                    >
                      <option value="lecture">ê°•ì˜</option>
                      <option value="exam">ì‹œí—˜</option>
                      <option value="practice">ì‹¤ìŠµ</option>
                      <option value="orientation">ì˜¤ë¦¬ì—”í…Œì´ì…˜</option>
                      <option value="ceremony">í–‰ì‚¬</option>
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ìƒíƒœ
                    </label>
                    <select
                      value={formData.status}
                      onChange={(e) => setFormData({ ...formData, status: e.target.value as any })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                    >
                      <option value="scheduled">ì˜ˆì •</option>
                      <option value="in_progress">ì§„í–‰ì¤‘</option>
                      <option value="completed">ì™„ë£Œ</option>
                      <option value="cancelled">ì·¨ì†Œ</option>
                    </select>
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium text-card-foreground mb-2">
                      ì°¸ì„ ì¸ì›
                    </label>
                    <input
                      type="number"
                      min="0"
                      value={formData.attendees}
                      onChange={(e) => setFormData({ ...formData, attendees: parseInt(e.target.value) || 0 })}
                      className="w-full border border-border rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-primary bg-background text-foreground"
                    />
                  </div>
                </div>

                {/* ë©”ëª¨ */}
                <div>
                  <label className="block text-sm font-medium text-card-foreground mb-2">
                    ë©”ëª¨
                  </label>
                  <textarea
                    rows={3}
                    value={formData.notes}
                    onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
                    className="w-full border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                    placeholder="ì¶”ê°€ ì •ë³´ë‚˜ íŠ¹ì´ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"
                  />
                </div>
              </form>
            </div>

            <div className="px-6 py-4 border-t border-border flex justify-end space-x-3">
              <button
                onClick={() => {
                  resetForm();
                  setShowEventModal(false);
                  setEditingEvent(null);
                }}
                className="btn-ghost"
              >
                ì·¨ì†Œ
              </button>
              <button
                onClick={handleSaveEvent}
                className="btn-primary"
              >
                {editingEvent ? 'ìˆ˜ì •' : 'ì €ì¥'}
              </button>
            </div>
          </div>
        </div>
      )}

      {/* ì—‘ì…€ ì¼ì • ê°€ì ¸ì˜¤ê¸° ëª¨ë‹¬ */}
      {showExcelImporter && (
        <ExcelScheduleImporter
          onImport={handleExcelImport}
          onClose={() => setShowExcelImporter(false)}
        />
      )}
    </div>
  );
};

export default ScheduleManager;