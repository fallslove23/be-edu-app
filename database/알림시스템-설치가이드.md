# 데이터베이스 설치 가이드

프로젝트의 모든 기능을 사용하려면 Supabase 데이터베이스에 다음 시스템들을 설치해야 합니다.

## 설치할 시스템

1. **알림 시스템**: 과정 시작, 변경, 충돌 감지 등
2. **커리큘럼 템플릿**: 시간표 템플릿 저장 및 재사용
3. **강사료 계산 시스템**: 강사 강의 시간 집계 및 강사료 자동 계산

---

# 1. 알림 시스템 설치

알림 시스템을 사용하려면 Supabase 데이터베이스에 테이블을 생성해야 합니다.

## 📋 설치 단계

### 1단계: Supabase 대시보드 접속

1. Supabase 프로젝트 대시보드에 로그인
2. 왼쪽 메뉴에서 **SQL Editor** 클릭

### 2단계: 마이그레이션 SQL 복사

다음 파일의 내용을 복사하세요:
```
database/migrations/create-notification-system-mock-auth.sql
```

### 3단계: SQL 실행

1. SQL Editor에서 **New query** 클릭
2. 복사한 SQL 코드를 붙여넣기
3. 우측 하단의 **RUN** 버튼 클릭 (또는 Ctrl/Cmd + Enter)

### 4단계: 실행 결과 확인

다음과 같은 메시지가 표시되면 성공:
```
Success. No rows returned
```

오류가 발생한 경우:
- `uuid_generate_v4()` 오류: Supabase에서 자동으로 제공되므로 무시해도 됩니다
- 테이블 이미 존재: `DROP TABLE` 후 다시 실행
- 외래 키 오류: 관련 테이블(`users`, `course_rounds`, `course_sessions`)이 먼저 생성되어 있는지 확인

## 🧪 설치 확인

SQL Editor에서 다음 쿼리로 테이블이 생성되었는지 확인:

```sql
-- 테이블 존재 확인
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
AND table_name IN ('notifications', 'notification_preferences', 'scheduled_notifications');
```

3개의 테이블이 표시되면 설치 완료!

## 📊 생성되는 테이블

### 1. `notifications`
- 사용자별 알림 데이터
- 과정 시작, 변경, 확정, 일정 충돌 등

### 2. `notification_preferences`
- 사용자별 알림 설정
- 알림 유형별 on/off
- 과정 시작 알림 시기 (D-1, D-3, D-7)

### 3. `scheduled_notifications`
- 예정된 알림 스케줄
- 자동 알림 발송 관리

## 🔍 문제 해결

### 문제: 알림 목록이 로드되지 않음
**해결**:
1. 브라우저 콘솔(F12)에서 오류 메시지 확인
2. Supabase 대시보드 → Table Editor에서 `notifications` 테이블 존재 확인
3. SQL Editor에서 다음 쿼리 실행하여 수동으로 테스트:
   ```sql
   SELECT * FROM notifications LIMIT 1;
   ```

### 문제: RLS 정책 오류
**해결**:
- Mock Auth 사용 시: `create-notification-system-mock-auth.sql` 사용 (RLS 비활성화)
- Supabase Auth 사용 시: `create-notification-system.sql` 사용 (RLS 활성화)

### 문제: 외래 키 오류
**해결**:
다음 테이블들이 먼저 생성되어 있어야 합니다:
- `users` (사용자 테이블)
- `course_rounds` (과정 테이블)
- `course_sessions` (일정 테이블)
- `round_enrollments` (등록 테이블)

## 📞 추가 지원

설치 중 문제가 발생하면:
1. [README-NOTIFICATION-SYSTEM.md](./README-NOTIFICATION-SYSTEM.md) 참고
2. Supabase 로그 확인
3. 프로젝트 이슈 트래커에 버그 리포트

---

# 2. 커리큘럼 템플릿 시스템 설치

## 📋 설치 단계

### 1단계: Supabase 대시보드 접속

1. Supabase 프로젝트 대시보드에 로그인
2. 왼쪽 메뉴에서 **SQL Editor** 클릭

### 2단계: 마이그레이션 SQL 복사

다음 파일의 내용을 복사하세요:
```
database/migrations/create-curriculum-templates-mock-auth.sql
```

### 3단계: SQL 실행

1. SQL Editor에서 **New query** 클릭
2. 복사한 SQL 코드를 붙여넣기
3. 우측 하단의 **RUN** 버튼 클릭

### 4단계: 실행 결과 확인

다음 쿼리로 테이블이 생성되었는지 확인:

```sql
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
AND table_name IN ('curriculum_templates', 'curriculum_template_sessions');
```

2개의 테이블이 표시되면 설치 완료!

## 📊 생성되는 테이블

### 1. `curriculum_templates`
- 커리큘럼 템플릿 메타데이터
- 템플릿 이름, 설명, 카테고리
- 총 교육 시간, 세션 수

### 2. `curriculum_template_sessions`
- 템플릿의 세부 세션 정보
- 차시 번호, 제목, 과목
- 수업 시간, 유형 (이론/실기/시험/토론)

## 📞 추가 지원

상세한 사용법은 [create-curriculum-templates.sql](./migrations/create-curriculum-templates.sql) 파일의 주석을 참고하세요.

---

# 3. 강사료 계산 시스템 설치

## 📋 설치 단계

### 1단계: Supabase 대시보드 접속

1. Supabase 프로젝트 대시보드에 로그인
2. 왼쪽 메뉴에서 **SQL Editor** 클릭

### 2단계: 마이그레이션 SQL 복사

다음 파일의 내용을 복사하세요:
```
database/migrations/create-instructor-payment-system.sql
```

### 3단계: SQL 실행

1. SQL Editor에서 **New query** 클릭
2. 복사한 SQL 코드를 붙여넣기
3. 우측 하단의 **RUN** 버튼 클릭

### 4단계: 실행 결과 확인

다음 쿼리로 테이블과 함수가 생성되었는지 확인:

```sql
-- 테이블 확인
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
AND table_name IN ('instructor_teaching_summary', 'instructor_payment_history');

-- 함수 확인
SELECT routine_name
FROM information_schema.routines
WHERE routine_schema = 'public'
AND routine_name IN ('calculate_instructor_hours', 'calculate_instructor_payment', 'update_instructor_summaries');
```

2개의 테이블과 3개의 함수가 표시되면 설치 완료!

## 📊 생성되는 스키마

### 1. course_sessions 테이블 확장
기존 테이블에 다음 컬럼 추가:
- `session_category`: 세션 유형 (lecture/practice)
- `primary_instructor_id`: 주강사 (10,000원/시간)
- `assistant_instructor_id`: 보조강사 (5,000원/시간)
- `actual_duration_hours`: 실제 강의 시간
- `is_payment_confirmed`: 강사료 지급 확정 여부

### 2. instructor_teaching_summary
- 강사별 강의 시간 집계
- 이론/실기 시간 구분
- 강사료 자동 계산
- 확정 프로세스

### 3. instructor_payment_history
- 실제 지급 이력
- 지급 방법, 상태 관리
- 세부 내역 기록

## 🎯 주요 기능

1. **자동 집계**: 완료된 세션의 강의 시간을 자동으로 집계
2. **강사료 계산**:
   - 주강사: 10,000원/시간
   - 보조강사: 5,000원/시간
3. **이론/실기 구분**: 각 유형별로 시간 집계
4. **확정 프로세스**: 관리자가 강사료를 확정하고 지급 등록

## 📞 추가 지원

상세한 사용법은 [README-INSTRUCTOR-PAYMENT-SYSTEM.md](./README-INSTRUCTOR-PAYMENT-SYSTEM.md)를 참고하세요.

---

## ✅ 전체 설치 확인

모든 시스템이 정상적으로 설치되었는지 확인:

```sql
-- 모든 테이블 확인
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public'
AND table_name IN (
  'notifications',
  'notification_preferences',
  'scheduled_notifications',
  'curriculum_templates',
  'curriculum_template_sessions',
  'instructor_teaching_summary',
  'instructor_payment_history'
)
ORDER BY table_name;
```

7개의 테이블이 모두 표시되면 설치 완료!

## 🎉 다음 단계

1. 애플리케이션을 재시작하세요
2. 관리자 계정으로 로그인
3. 각 기능을 테스트해보세요:
   - 알림 센터 (헤더의 벨 아이콘)
   - 커리큘럼 관리 (템플릿 기능)
   - 강사료 계산 (관리자 메뉴)
